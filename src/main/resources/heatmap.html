<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Ramify FSC Campus Heatmap</title>
    <link rel="stylesheet" href="/css/heatmap.css" />
</head>
<body>
<h1>Campus Activity Heatmap</h1>

<div id="map-wrapper">
    <img id="campus-map" src="/images/campus-map.png" alt="FSC Campus Map" />
    <div id="heat-overlay"></div>
</div>

<script>
// ---- Your normalized coordinates ----
const AREA_POINTS = {
    "Nold Hall": { x: 0.155, y: 0.585 },
    "The Great Lawn": { x: 0.365, y: 0.600 },
    "Lupton Hall": { x: 0.335, y: 0.470 },
    "Roosevelt Hall": { x: 0.410, y: 0.585 },
    "Hale Hall": { x: 0.510, y: 0.395 },
    "Greenley Hall": { x: 0.515, y: 0.485 },
    "Knapp Hall": { x: 0.530, y: 0.565 },
    "Business School": { x: 0.540, y: 0.645 },
    "Memorial Hall": { x: 0.460, y: 0.695 },
    "Health": { x: 0.490, y: 0.735 },
    "Gleeson Hall": { x: 0.615, y: 0.415 },
    "Ward Hall": { x: 0.580, y: 0.455 },
    "Whitman Hall": { x: 0.600, y: 0.510 },
    "Thompson Hall": { x: 0.640, y: 0.505 },
    "Hicks Hall": { x: 0.670, y: 0.525 },
    "Little Theater": { x: 0.675, y: 0.565 },
    "Campus Center": { x: 0.650, y: 0.345 },
    "Conklin Hall": { x: 0.600, y: 0.355 },
    "Auditorium": { x: 0.670, y: 0.395 },
    "Horton Hall": { x: 0.735, y: 0.350 },
    "Police": { x: 0.780, y: 0.375 },
    "Teaching Gardens": { x: 0.730, y: 0.500 },
    "Greenhouse": { x: 0.770, y: 0.545 },
    "Biotech Facility": { x: 0.880, y: 0.375 },
    "Sinclair Hall": { x: 0.600, y: 0.755 },
    "Dewey Hall": { x: 0.570, y: 0.785 },
    "Alumni Hall": { x: 0.515, y: 0.755 },
    "Applied Social Science": { x: 0.660, y: 0.665 },
    "Building Systems": { x: 0.750, y: 0.675 },
    "Children's Center": { x: 0.820, y: 0.785 },
    "Orchard Hall": { x: 0.920, y: 0.855 }
};

const mapImg = document.getElementById("campus-map");
const overlay = document.getElementById("heat-overlay");

// This function is called from Java with the area counts
window.renderHeatmapFromJava = function(areaCounts) {
    console.log("Received data from Java:", areaCounts);
    
    overlay.innerHTML = "";
    
    const width = mapImg.clientWidth;
    const height = mapImg.clientHeight;
    
    // Find max count for normalization
    const maxCount = Math.max(...Object.values(areaCounts), 1);
    
    Object.entries(areaCounts).forEach(([area, count]) => {
        const pt = AREA_POINTS[area];
        if (!pt) {
            console.warn("No coordinates for area:", area);
            return;
        }

        const dot = document.createElement("div");
        dot.className = "heat-dot";
        dot.dataset.label = `${area} (${count} responses)`;

        // Convert normalized coords to pixels
        const x = pt.x * width;
        const y = pt.y * height;
        dot.style.left = `${x}px`;
        dot.style.top = `${y}px`;

        // Normalize intensity between 0 and 1 based on count
        const intensity = Math.min(count / maxCount, 1);
        dot.style.setProperty("--intensity", intensity.toString());

        overlay.appendChild(dot);
    });
    
    console.log("Rendered", Object.keys(areaCounts).length, "heat points");
};

// Show a loading message initially
overlay.innerHTML = '<div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#0b5e2a; font-size:18px;">Loading heatmap data...</div>';
</script>
</body>
</html>
